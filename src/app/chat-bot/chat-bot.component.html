<!-- chat.component.html -->

<div class="chat-icon" (click)="toggleChatWindow()">ðŸ’¬</div>

<div class="chat-container" *ngIf="showChatWindow" #chatWindow>

  <div class="header">

    <i class="pi pi-android" style="color:#f5df6e;font-size:2rem;"></i>
    <span style="color: white;font-weight: bold;font-size: x-large;margin-left: 2%;">Kart Support</span>
   
    <!-- Delete Confirmation ngPrime popup -->
    <p-confirmPopup>
      <ng-template pTemplate="content">
        <div class="flex flex-column align-items-center w-full gap-3 border-bottom-1 surface-border p-3 mb-3">
          <!-- <div class="flex align-items-center gap-2 mt-3"> -->
          <p style="color: blue;font-weight: bold;">Confirm Exit?</p>
          <p>On exiting, all chat history will be cleared</p>
        </div>
      </ng-template>
    </p-confirmPopup>

    <span class="close-button topright">
      <button pButton type="button" icon="pi pi-window-minimize" class="p-button-secondary"
        (click)="toggleChatWindow()"></button>

      <button pButton type="button" icon="pi pi-times" class="p-button-danger" 
      (click)="confirm($event)"></button>
    </span>

  <!-- Header Message Component -->
    <div style="color: white;">
      <p style="font-weight: bold;">Hi,
        <span>
          <svg class="waving-hand" fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg"
            transform="rotate(45)">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path
                d="M216.73926,105.98828l-20-34.64062a23.96962,23.96962,0,0,0-43.56641,4.54L132.09863,39.38574a23.98653,23.98653,0,0,0-43.61328,4.63471A23.98944,23.98944,0,0,0,47.88867,69.5293l7.06592,12.23822a23.98426,23.98426,0,0,0-25.70752,35.47467l42,72.74609a84,84,0,1,0,145.49219-84Zm.665,61.67041A76.00079,76.00079,0,0,1,78.1748,185.98828l-42-72.74609A16.00046,16.00046,0,0,1,63.88818,97.24133l22.00049,38.10633a4.0033,4.0033,0,0,0,.42285.58746c.03809.04486.07666.08807.11621.13092a3.98886,3.98886,0,0,0,.50245.46454l.01123.00958a3.979,3.979,0,0,0,.58642.35956c.05127.02612.10205.05048.1543.0744a3.9997,3.9997,0,0,0,.604.22546c.01319.00367.02539.0094.03858.01288a4.0121,4.0121,0,0,0,.66894.11225c.05713.00519.11377.0083.1709.011.064.00312.12744.01239.1919.01239a3.99015,3.99015,0,0,0,.46191-.02966c.01172-.00134.02344-.00073.03467-.0022a3.9747,3.9747,0,0,0,.6792-.15362c.05371-.01666.10693-.03485.16015-.054a3.96357,3.96357,0,0,0,2.124-5.761l-22-38.10547-.001-.00171L54.81641,65.5293a16,16,0,0,1,27.71289-16l34,58.89013a3.9998,3.9998,0,1,0,6.92773-4l-26-45.03369a16.00046,16.00046,0,0,1,27.71387-16l29.99756,51.95752.00244.0044,8.08887,14.01025a44.00842,44.00842,0,0,0-12.73047,57.95117,3.9998,3.9998,0,1,0,6.92773-4,36.00049,36.00049,0,0,1,13.17774-49.17676,4.00305,4.00305,0,0,0,.64648-.46606,3.84134,3.84134,0,0,0,.31885-.34094c.06982-.07794.14941-.1471.21289-.23017a4.00607,4.00607,0,0,0,.28857-.46344c.03809-.06781.0874-.12878.12158-.19891a4.01364,4.01364,0,0,0,.40186-1.49805c.00586-.08435-.00684-.168-.00684-.25232a3.88552,3.88552,0,0,0-.01757-.52734c-.01221-.09564-.04444-.18744-.06348-.28192a3.93468,3.93468,0,0,0-.11182-.48035,4.0298,4.0298,0,0,0-.32666-.72485l-10.001-17.32257a15.99989,15.99989,0,0,1,27.71386-15.99774l20,34.64062A75.50307,75.50307,0,0,1,217.4043,167.65869ZM84.38086,242.28223A3.99888,3.99888,0,0,1,78.81445,243.29a114.9806,114.9806,0,0,1-34.27832-37.29932,3.9998,3.9998,0,0,1,6.92774-4,107.03846,107.03846,0,0,0,31.90918,34.7251A4.00005,4.00005,0,0,1,84.38086,242.28223ZM172,30.99609A4.0003,4.0003,0,0,1,176,27h.00391a56.19919,56.19919,0,0,1,48.48535,28.00439,3.9998,3.9998,0,1,1-6.92774,4A48.17581,48.17581,0,0,0,175.99609,35,3.99989,3.99989,0,0,1,172,30.99609Z">
              </path>
            </g>
          </svg>
        </span>
      </p>
      <span>I am Eva, your very own personal assistant.</span>
    </div>
  </div>

<!-- Category Selection Button -->
  <div style="margin: 2%;cursor: pointer;">

    <mat-chip-set>
      <mat-chip *ngFor="let category of categories" (click)="chooseCategory(category)">
        <p> {{ category }}</p>
      </mat-chip>
    </mat-chip-set>

  </div>

  <!-- Chat Message Container -->
  <div class="messages">
    <div *ngFor="let message of chatHistory" class="message"
      [ngClass]="{'user-message': message.sender === 'user', 'bot-message': message.sender === 'bot'}">

      <i *ngIf="message.sender === 'bot'" class="pi pi-android" style="color: rgb(157 235 232);font-size:1.5rem;"></i>
      <i *ngIf="message.sender === 'user'" class="pi pi-user" style="color: rgb(157 235 232);font-size:1.3rem;"></i>

      <div *ngIf="message.sender === 'user'" class="edit-delete-buttons">
        <button ><mat-icon>edit</mat-icon></button>
        <button ><mat-icon>delete</mat-icon></button>
      </div>

      <!-- Category Product -->
      <span *ngIf="message.clickable">
        <div fxFlex="25">
          <mat-card (click)="navigateToProduct(message.message.id)">
            <mat-card-content>
              <img class="image" [src]="message.message.image" alt="img not available">

              <mat-card-title class="wrap">{{message.message.title}}</mat-card-title>

              <div>
                <span style="background-color: green;color: white;">{{message.message.rating.rate}}
                  <mat-icon style="height: 19px; width: 28px;">star</mat-icon></span>
                <span style="font-weight: 400; color: black;margin-left:1.5% ;">{{message.message.price | currency:'INR'
                  }}</span> &nbsp; <span style="color:green">
                  50% off</span>
                <span> <img src="assets/assured.jpg" style="height: 15px; width: 15px;margin-left: 3%;"></span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </span>

      <!-- Normal Msgs -->
      <span *ngIf="!message.clickable">{{ message.message }}</span>

      <p style="text-align: right;font-size: 10px;font-weight: 500;margin-bottom: 0;color: #ddd0d0;">{{ message.time |
        date: 'hh:mm a' }}
        <!-- Double tick svg -->
        <svg *ngIf="message.sender === 'user'" width="17px" height="17px" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)">
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <path d="M1.5 12.5L5.57574 16.5757C5.81005 16.8101 6.18995 16.8101 6.42426 16.5757L9 14" stroke="#000000"
              stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M16 7L12 11" stroke="#000000" stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M7 12L11.5757 16.5757C11.8101 16.8101 12.1899 16.8101 12.4243 16.5757L22 7" stroke="#000000"
              stroke-width="1.5" stroke-linecap="round"></path>
          </g>
        </svg>
      </p>
    </div>

  </div>


  <div class="input-container">
    <input matInput type="text" [(ngModel)]="userInput" (keyup.enter)="sendMessage()" placeholder="Type a message...">
    <button mat-raised-button color="primary" (click)="sendMessage()">Send</button>
  </div>
</div>